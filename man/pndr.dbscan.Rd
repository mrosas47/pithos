% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dbscan.R
\name{pndr.dbscan}
\alias{pndr.dbscan}
\title{Density-based clustering for sf POINT or data.frame (+ concave hulls)}
\usage{
pndr.dbscan(
  x,
  eps,
  min_pts = 5,
  cols = NULL,
  cluster_col = "cluster",
  na_ok = T,
  concavity = 0.5,
  buffer_m = 50,
  layer = NULL,
  crs = NULL,
  ...
)
}
\arguments{
\item{x}{An `sf` object with POINT geometries, or a `data.frame`.}

\item{eps}{Neighbourhood radius (same units as input coords).}

\item{min_pts}{Minimum number of points to form a dense region.}

\item{cols}{When `x` is a data.frame, a character vector of length 2
naming the coordinate columns (e.g., `c('x','y')`). If `NULL`, the
function will try common names, then fall back to the first two
numeric columns.}

\item{cluster_col}{Name for the output cluster label column.}

\item{na_ok}{Logical. If `T`, rows with missing coordinates are kept in
the output with `NA` cluster labels; only complete rows are used to
fit DBSCAN. If `F`, the function errors on missing coordinates.}

\item{concavity}{Ratio for `st_concave_hull()` (0–1, lower → more concave).}

\item{buffer_m}{Numeric buffer to apply to hulls after validity fixes.
Units are those of the layer CRS; use metres only if the CRS units are metres.}

\item{layer}{Optional scalar to add a `layer` column to the hulls, mirroring
the example snippet.}

\item{crs}{When `x` is a data.frame, optional CRS (e.g., 4326 or a `crs`
object) to assign to the created points before hull computation.}

\item{...}{Additional arguments passed to `dbscan::dbscan()`.}
}
\value{
A list with elements:
\item{result}{The fitted `dbscan` object.}
\item{data}{The original object with an added `cluster_col` column.}
\item{hulls}{An `sf` layer of concave hulls with columns `cluster`, optional `layer`,
and geometry column named `geom`. `NULL` if no clusters were found.}
}
\description{
Runs DBSCAN on either an sf POINT layer (using geometry coordinates)
or a plain data.frame (using provided or inferred coordinate columns).
Returns the fitted `dbscan` object, the original data with an added
cluster label column, and an `sf` MULTIPOLYGON layer of concave hulls
per cluster (excluding noise `0` and `NA`).
}
\details{
For sf inputs, only POINT geometries are supported. Noise points are
labelled `0` as in `dbscan`. Hulls are computed per cluster id > 0
over the subset of rows with complete coordinates used in the fit.
If the input is a data.frame, hulls are still produced by internally
creating an sf POINT layer from the coordinate columns.
}
\examples{
\dontrun{
library(sf)
library(dbscan)

df <- data.frame(x = rnorm(300), y = rnorm(300))
out <- pndr.dbscan_cluster(df, eps = 0.25, min_pts = 8, concavity = 0.5, buffer_m = 0, crs = 3857)
plot(st_geometry(out$hulls))

pts <- st_as_sf(df, coords = c('x','y'), crs = 4326)
out_sf <- pndr.dbscan_cluster(pts, eps = 0.01, min_pts = 5, concavity = 0.4)
table(out_sf$data$cluster)
}

}
